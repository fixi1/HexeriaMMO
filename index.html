<!DOCTYPE html>
<html>
<head>
  <title>MMO on Render</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      display: flex;
      height: 100vh;
    }

    #left-panel {
      width: 250px;
      background: #2c3e50;
      color: white;
      padding: 15px;
      overflow-y: auto;
    }

    #game-area {
      flex: 1;
      position: relative;
      background: #e0f7fa;
      border: 1px solid #999;
      overflow: hidden;
    }

    #right-panel {
      width: 250px;
      background: #34495e;
      color: white;
      padding: 15px;
      overflow-y: auto;
    }

    .player {
      position: absolute;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      text-align: center;
      line-height: 30px;
      font-size: 10px;
      color: white;
      font-weight: bold;
    }

    .me {
      border: 2px solid white;
    }

    .other {
      opacity: 0.8;
    }

    #chat-input {
      width: 100%;
      padding: 8px;
      margin-top: 10px;
      box-sizing: border-box;
    }

    #chat-messages {
      height: 300px;
      overflow-y: auto;
      margin-bottom: 10px;
      padding: 10px;
      background: #2c3e50;
      border-radius: 5px;
    }

    .chat-message {
      margin: 5px 0;
      padding: 5px;
      background: #34495e;
      border-radius: 5px;
    }

    .inventory-item {
      padding: 8px;
      margin: 5px 0;
      background: #34495e;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .inventory-item:hover {
      background: #bdc3c7;
      color: #2c3e50;
    }

    .equipped {
      border: 2px solid gold;
    }

    #character-stats {
      background: #34495e;
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 15px;
    }

    button {
      padding: 5px 10px;
      margin: 5px;
      cursor: pointer;
    }

    #customizer {
      background: #34495e;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 15px;
    }

    #customizer input, #customizer select {
      width: 100%;
      margin: 5px 0;
      padding: 5px;
    }
  </style>
</head>
<body>
  <div id="left-panel">
    <h3>Inventory</h3>
    <div id="weapons-list"></div>
    <div id="armor-list"></div>
    <div id="potions-list"></div>

    <h3>Character Stats</h3>
    <div id="character-stats">
      <p>HP: <span id="hp">-</span>/<span id="maxHp">-</span></p>
      <p>Level: <span id="level">-</span></p>
      <p>XP: <span id="xp">-</span></p>
      <p>Class: <span id="class">-</span></p>
    </div>

    <button onclick="usePotion()">Use Potion</button>
  </div>

  <div id="game-area"></div>

  <div id="right-panel">
    <h3>Chat</h3>
    <div id="chat-messages"></div>
    <input id="chat-input" placeholder="Type a message..." onkeypress="if(event.key==='Enter') sendChat()">
    <button onclick="sendChat()">Send</button>

    <h3>Customize Character</h3>
    <div id="customizer">
      <input id="char-name" placeholder="Name" value="Player">
      <select id="char-class">
        <option>Warrior</option>
        <option>Mage</option>
        <option>Rogue</option>
      </select>
      <input id="char-color" type="color" value="#ff5722">
      <button onclick="applyCustomization()">Apply</button>
    </div>
  </div>

  <script>
    let playerId = null;
    let myX = 100, myY = 100;
    let myColor = '#ff5722';
    let myName = 'Player';
    let myClass = 'Warrior';
    let myHp = 100;
    let myMaxHp = 100;
    let myLevel = 1;
    let myXp = 0;
    let myInventory = { weapons: [], armor: [], potions: [] };
    let myEquipped = { weapon: null, armor: null };

    const players = {};
    const keys = {};
    const socket = new WebSocket(`wss://${window.location.host}`);

    socket.onmessage = (e) => {
      const msg = JSON.parse(e.data);

      if (msg.type === 'init') {
        playerId = msg.playerId;
        updateMyCharacter(msg.player);
        createOrUpdatePlayer(playerId, msg.player.x, msg.player.y, true);
      }

      else if (msg.type === 'playerJoined') {
        if (msg.player.id !== playerId) {
          createOrUpdatePlayer(msg.player.id, msg.player.x, msg.player.y, false);
        }
      }

      else if (msg.type === 'move') {
        if (msg.id !== playerId) {
          movePlayer(msg.id, msg.x, msg.y);
        }
      }

      else if (msg.type === 'playerLeft') {
        removePlayer(msg.id);
      }

      else if (msg.type === 'chat') {
        addChatMessage(msg.name, msg.message);
      }

      else if (msg.type === 'playerUsedPotion') {
        addChatMessage(msg.name, `used ${msg.name}!`);
      }

      else if (msg.type === 'updateStats') {
        if (msg.hp !== undefined) {
          myHp = msg.hp;
          document.getElementById('hp').innerText = myHp;
        }
      }

      else if (msg.type === 'updateEquipped') {
        myEquipped = msg.equipped;
        renderInventory();
      }
    };

    function updateMyCharacter(player) {
      myName = player.name;
      myClass = player.class;
      myColor = player.color;
      myHp = player.hp;
      myMaxHp = player.maxHp;
      myLevel = player.level;
      myXp = player.xp;
      myInventory = player.inventory;
      myEquipped = player.equipped;

      document.getElementById('hp').innerText = myHp;
      document.getElementById('maxHp').innerText = myMaxHp;
      document.getElementById('level').innerText = myLevel;
      document.getElementById('xp').innerText = myXp;
      document.getElementById('class').innerText = myClass;

      renderInventory();
    }

    function renderInventory() {
      const weaponsDiv = document.getElementById('weapons-list');
      const armorDiv = document.getElementById('armor-list');
      const potionsDiv = document.getElementById('potions-list');

      weaponsDiv.innerHTML = '<h4>Weapons</h4>';
      armorDiv.innerHTML = '<h4>Armor</h4>';
      potionsDiv.innerHTML = '<h4>Potions</h4>';

      myInventory.weapons.forEach(w => {
        const div = document.createElement('div');
        div.className = 'inventory-item' + (myEquipped.weapon?.name === w.name ? ' equipped' : '');
        div.innerText = w.name;
        div.onclick = () => equipItem('weapon', w);
        weaponsDiv.appendChild(div);
      });

      myInventory.armor.forEach(a => {
        const div = document.createElement('div');
        div.className = 'inventory-item' + (myEquipped.armor?.name === a.name ? ' equipped' : '');
        div.innerText = a.name;
        div.onclick = () => equipItem('armor', a);
        armorDiv.appendChild(div);
      });

      myInventory.potions.forEach(p => {
        const div = document.createElement('div');
        div.className = 'inventory-item';
        div.innerText = p.name;
        div.onclick = usePotion;
        potionsDiv.appendChild(div);
      });
    }

    function equipItem(slot, item) {
      myEquipped[slot] = item;
      socket.send(JSON.stringify({ type: 'equip', slot, item }));
      renderInventory();
    }

    function usePotion() {
      if (myInventory.potions.length > 0) {
        socket.send(JSON.stringify({ type: 'usePotion' }));
      }
    }

    function applyCustomization() {
      myName = document.getElementById('char-name').value;
      myClass = document.getElementById('char-class').value;
      myColor = document.getElementById('char-color').value;

      socket.send(JSON.stringify({
        type: 'init',
        name: myName,
        class: myClass,
        color: myColor
      }));
    }

    function addChatMessage(name, message) {
      const div = document.createElement('div');
      div.className = 'chat-message';
      div.innerHTML = `<strong>${name}:</strong> ${message}`;
      document.getElementById('chat-messages').appendChild(div);
      document.getElementById('chat-messages').scrollTop = document.getElementById('chat-messages').scrollHeight;
    }

    function sendChat() {
      const input = document.getElementById('chat-input');
      const message = input.value.trim();
      if (message) {
        socket.send(JSON.stringify({ type: 'chat', message }));
        addChatMessage(myName, message);
        input.value = '';
      }
    }

    function createOrUpdatePlayer(id, x, y, isMe = false) {
      if (players[id]) {
        players[id].div.style.left = x + 'px';
        players[id].div.style.top = y + 'px';
        return;
      }

      const div = document.createElement('div');
      div.className = `player ${isMe ? 'me' : 'other'}`;
      div.style.backgroundColor = isMe ? myColor : '#2196f3';
      div.textContent = isMe ? 'ME' : 'P';
      div.style.left = x + 'px';
      div.style.top = y + 'px';
      document.getElementById('game-area').appendChild(div);

      players[id] = { div, x, y };
    }

    function movePlayer(id, x, y) {
      if (players[id]) {
        players[id].div.style.left = x + 'px';
        players[id].div.style.top = y + 'px';
      }
    }

    function removePlayer(id) {
      if (players[id]) {
        players[id].div.remove();
        delete players[id];
      }
    }

    window.addEventListener('keydown', e => {
      if (['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(e.key)) {
        keys[e.key] = true;
        e.preventDefault();
      }
    });

    window.addEventListener('keyup', e => {
      if (['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(e.key)) {
        keys[e.key] = false;
        e.preventDefault();
      }
    });

    setInterval(() => {
      if (!playerId) return;
      let moved = false;
      const s = 5;
      if (keys['ArrowUp']) { myY -= s; moved = true; }
      if (keys['ArrowDown']) { myY += s; moved = true; }
      if (keys['ArrowLeft']) { myX -= s; moved = true; }
      if (keys['ArrowRight']) { myX += s; moved = true; }
      myX = Math.max(0, Math.min(770, myX));
      myY = Math.max(0, Math.min(570, myY));
      if (moved) {
        socket.send(JSON.stringify({ type: 'move', x: myX, y: myY }));
        movePlayer(playerId, myX, myY);
      }
    }, 1000/60);
  </script>
</body>
</html>
